mixin oracleRoll(id, table, row)
  -
    //- appends any Assets or Details info to the row
    var chanceFloor = row.roll.min
    var chanceCeiling = row.roll.max;
    const result = translation[row._id]
  if chanceFloor === chanceCeiling
    | {{#rollTotal() #{id} #{chanceCeiling}}}
    |
    span!=result
    |
    | {{/rollTotal() #{id} #{chanceCeiling}}}
  else
    |
    | {{#rollBetween() #{id} #{chanceFloor} #{chanceCeiling}}}
    |
    span!=result
    |
    | {{/rollBetween() #{id} #{chanceFloor} #{chanceCeiling}}}

mixin oracleTemplate(oracle, oracle_key)
  - const id = oracle._id;
  - console.log("====== OracleTemplate ",oracle_key, id)
  |
  | {{##{id}}}
  .sheet-result-row
    .sheet-oracle-dice
      span {{#{id}}}
    .sheet-oracle-table-text
      if oracle.rows
        each row in oracle.rows
          +oracleRoll(id, oracle.rows, row)
      //- else if oracle.Tables
      //-   each subtable, index in oracle.Tables
      //-     |
      //-     | {{#rollTotal() tableChoice #{index}}}
      //-     each row, index in subtable.Table
      //-       +oracleRoll(id, subtable.Table, row, index)
      //-       |
      //-     | {{/rollTotal() tableChoice #{index}}}
      else if oracle.Oracles
        - let counter = 0;
        //- uses a counter instead of index to better handle any nested subtables
        - console.log("WARNING: I don't think we have oracle.Oracles done yet... ", oracle_key)
        each subCatOracle in oracle.Oracles
          if subCatOracle.Table
            |
            | {{#rollTotal() tableChoice #{counter}}}
            each row, index in subCatOracle.Table
              +oracleRoll(id, subCatOracle.Table, row, index)
              |
            | {{/rollTotal() tableChoice #{counter}}}
            - counter++
          if subCatOracle.Oracles
            each subSubCatOracle in subCatOracle.Oracles
              |
              | {{#rollTotal() tableChoice #{counter}}}
              each row, index in subSubCatOracle.Table
                +oracleRoll(id, subSubCatOracle.Table, row, index)
                |
              | {{/rollTotal() tableChoice #{counter}}}
              - counter++
      else
        - console.log("Warning parsed", oracle_key, "without detecting rows")



  |
  | {{/#{id}}}

rolltemplate(class=`sheet-rolltemplate-ferunners_oracles`)
  .sheet-roll-container
    .sheet-subheader {{header}}
    | {{#custom-oracle}}
    .sheet-result-row
      .sheet-oracle-table-text {{custom-oracle}}
    | {{/custom-oracle}}

    each category, category_id in core.oracles
      each oracle, oracle_key in category.contents
        +oracleTemplate(oracle, oracle_key)
        if oracle.collections
          each subCategory, subCategory_key in oracle.collections
            +oracleTemplate(subCategory, subCategory_key)